<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bifrost Gateway (UI)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px}
    header{background:#0b74de;color:white;padding:12px;border-radius:6px;margin-bottom:16px}
    .card{border:1px solid #ddd;padding:12px;border-radius:6px;margin-bottom:12px}
    .btn{display:inline-block;padding:6px 10px;background:#0b74de;color:#fff;border-radius:4px;text-decoration:none}
    .danger{background:#d9534f}
    pre{background:#f7f7f7;padding:8px;border-radius:4px}
  </style>
</head>
<body>
<header>
  <h1>Bifrost Gateway UI</h1>
  <div id="status">Loading status…</div>
  <div style="float:right">
    <form id="logoutForm" action="/logout" method="post" style="display:inline"><button class="btn">Logout</button></form>
  </div>
</header>

<main>
  <section class="card">
    <h2>Upload WireGuard config</h2>
    <form id="uploadForm" action="/api/wg/upload" method="post" enctype="multipart/form-data">
      <input type="file" name="file"> <button class="btn">Upload</button>
    </form>
  </section>

  <section class="card">
    <h2>Available configs</h2>
    <ul id="cfg-list">
    {% for c in configs %}
      <li>
        <strong>{{ c }}</strong>
        {% if c == active %} <em>(active)</em> {% endif %}
        <form style="display:inline" action="/api/wg/activate" method="post"><input type="hidden" name="name" value="{{c}}"><button class="btn">Activate</button></form>
        <form style="display:inline" action="/api/wg/delete" method="post"><input type="hidden" name="name" value="{{c}}"><button class="btn danger">Delete</button></form>
        <button class="btn" onclick="preview('{{c}}', this)">Preview</button>
        <div class="preview" id="preview-{{c}}" style="margin-top:6px"></div>
      </li>
    {% else %}
      <li>No configs found.</li>
    {% endfor %}
    </ul>
  </section>
</main>

<script>
async function fetchStatus(){
  try{
    const r = await fetch('/api/status');
    if(!r.ok) throw new Error('api');
    const data = await r.json();
    document.getElementById('status').textContent = `Uptime ${data.uptime_seconds || 'unknown'}s — main ${data.main_iface || 'unknown'} — active wg ${data.active_wg || 'none'}`;
  }catch(e){
    document.getElementById('status').textContent = 'Status unavailable';
  }
}
fetchStatus(); setInterval(fetchStatus, 10000);

async function preview(name, btn){
  const el = document.getElementById('preview-' + name);
  el.textContent = 'Loading...';
  try{
    const r = await fetch('/api/wg/preview?name=' + encodeURIComponent(name));
    if(!r.ok) throw new Error('failed');
    const j = await r.json();
    el.innerHTML = '<pre>' + (j.head || '') + '\n...\n' + (j.tail || '') + '</pre>';
  }catch(e){
    el.textContent = 'Preview unavailable';
  }
}
</script>
</body>
</html>
